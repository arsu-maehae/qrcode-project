<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>Admin Panel - QR Codes</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    tr:nth-child(even) { background: #fafafa; }
    button { padding: 6px 10px; margin: 4px; cursor: pointer; }
    .btn-del { background: #dc2626; color: #fff; border: none; border-radius: 4px; }
    .btn-del:hover { background: #b91c1c; }
  </style>
</head>
<body>
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - QR Codes</h1>
  <button onclick="loadData()">üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  <table id="qrTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Code</th>
        <th>User Agent</th>
        <th>Created At</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // üëâ ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà backend FastAPI
    const API_BASE = "http://127.0.0.1:8000";

    async function loadData() {
      try {
        const res = await fetch(`${API_BASE}/qrcodes`);
        if (!res.ok) throw new Error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        const data = await res.json();

        const tbody = document.querySelector("#qrTable tbody");
        tbody.innerHTML = "";

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
          return;
        }

        data.forEach(row => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.id}</td>
            <td>${row.code}</td>
            <td>${row.user_agent || "-"}</td>
            <td>${row.created_at}</td>
            <td><button class="btn-del" onclick="deleteRow('${row.id}')">‡∏•‡∏ö</button></td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        alert("‚ùå " + err.message);
      }
    }

    async function deleteRow(id) {
      if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö QR ‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      try {
        const res = await fetch(`${API_BASE}/qrcodes/${id}`, { method: "DELETE" });
        if (!res.ok) throw new Error("‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        alert("‚úÖ ‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        loadData();
      } catch (err) {
        alert("‚ùå " + err.message);
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    loadData();
  </script>
</body>
</html>
